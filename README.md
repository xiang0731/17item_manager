# 17 物品管理系统 (17 Item Manager) 

> 参考 Snipe-IT / Homebox / Grocy 设计的单文件 PHP 物品管理系统  
> 零配置部署，SQLite 数据库，适配 Synology NAS Web Station

详细实现文档：`IMPLEMENTATION_DETAILS.md`

---

## 功能概览

### 📊 仪表盘
- 五大统计卡片：物品种类、物品总数、分类数、位置数、总价值
- **过期提醒**：按过期日期排序展示，已过期 / 即将过期 / 正常三级颜色标识
- **备忘提醒**：统一展示循环提醒与购物清单提醒，支持待完成 / 已完成 / 撤销
- 备忘提醒右上角分项统计：过期 / 循环 / 购物 三类提醒条数
- 最近更新物品列表（快速预览）
- 状态统计（自动隐藏 0 数据状态）
- 分类统计进度条（仅统计使用中物品），右上角显示未分类件数
- 分类统计与状态统计统一显示单位“件”
- 过期提醒与备忘提醒卡片在深浅色模式下统一优化色阶与边框对比

### 📦 物品管理
- 卡片式网格展示，支持图片预览
- 完整字段：名称、一级分类、二级分类、位置、数量、价格、购入日期、过期日期、购入渠道、备注、条码/序列号、标签、描述
- 自定义状态管理：预设使用中/已归档/已转卖，支持新增/编辑/删除状态（英文标识 + 中文显示）
- 按状态自动分组显示，空组隐藏
- 图片上传（支持 JPG / PNG / GIF / WebP，最大 10MB）
- 三种视图尺寸：大（卡片）/ 中（紧凑）/ 小（列表）
- **属性显示控制**：可自由勾选物品卡片中显示的属性（分类、位置、件数、价格、过期日期、购入渠道、备注）
- **过期管理过滤器**：一键筛选仅显示设置过过期日期的物品
- 多维度筛选：关键词搜索、分类、位置、状态
- 多种排序：最近更新 / 最近添加 / 名称 / 价格 / 数量
- 物品详情弹窗（点击卡片查看完整信息）
- 批量选择 + 批量删除（移入回收站）
- 分页浏览
- 日期空值占位统一为 `____年/__月/__日`
- 编辑弹窗关闭前支持未保存提醒（忽略修改 / 保存修改）

### 🛒 购物清单
- 独立购物清单页面，支持新增/编辑/删除
- 字段支持：名称、数量、状态、优先级、预算、提醒日期、提醒备注、备注
- 清单状态支持“待购买 / 待收货”，并按状态分组展示（待购买在上）
- 支持一键“已购买入库”，并复用物品编辑结构（提交文案为“保存入库”）
- 编辑清单新增状态切换按钮（“已购买 / 待购买”），点击后自动保存并关闭弹窗
- 待收货分组为空时不显示“暂无待收货清单”占位文案
- 可从仪表盘备忘提醒直接跳转购物清单并打开对应编辑弹窗

### 🌐 公共频道
- 物品可勾选“共享到公共频道”，向所有用户展示基础属性（分类、购入价格、购入渠道）
- 公共频道支持一键“加入我的购物清单”
- 加入购物清单时自动带入推荐理由等上下文信息，数量备注更清晰（如“1件”）
- 共享物品支持发布者编辑（仅发布者可编辑）
- 公共频道支持评论互动（所有用户可评论）
- 评论支持权限删除：仅评论者本人或管理员可删除
- 共享记录失效时自动清理关联评论，避免脏数据残留

### 🗑️ 回收站
- 删除的物品自动移入回收站（软删除），不会立即永久删除
- 回收站物品列表，显示物品信息和删除时间
- 单个恢复 / 全部恢复
- 单个彻底删除 / 清空回收站
- 物品关联图片同步移入 `data/uploads/trash/` 目录保存，恢复时自动移回
- 图片仅在清空回收站或彻底删除时才被永久移除
- 回收站入口位于物品管理视图内

### 🏷️ 分类管理
- 自定义分类名称、Emoji 图标、颜色
- 支持两级分类（一级 + 二级），二级分类可随一级分类联动选择
- 预设 10 个常用一级分类（含“虚拟产品”“食物”），并为每个一级分类预置常见二级分类
- 分类管理支持一对多可视化展示（一级分类 -> 二级分类）
- 显示每个分类下的物品数量

### 📍 位置管理
- 单级位置管理（所有位置同一层级）
- 默认预置常用位置（客厅、卧室、厨房、书房），支持后续自由扩展
- 位置支持 Emoji 图标，列表展示、筛选和编辑体验一致
- 位置描述和物品统计

### 🔄 数据管理
- 导出 JSON 文件（完整备份，含物品、分类、位置；文件名精确到秒）
- 可选同时导出图片数据（嵌入式 Base64）
- 导出 CSV 文件（方便 Excel 查看和编辑）
- 从 JSON 文件导入恢复（支持带内置图片数据）
- 手动批量导入：下载默认 Excel 模板（CSV）后批量导入
- 批量导入日期校验：支持 `YYYY-MM-DD` / `YYYY/MM/DD`（如 `2026/2/9`），不合规行自动跳过并给出可手动关闭提示
- 导入模糊匹配：分类/位置/购入渠道/状态支持模糊匹配已有值，不存在时使用默认值
- 数据管理内置「物品数据重置」与「恢复默认环境」

### 👤 账号与权限
- 登录/注册/退出登录完整流程，按用户隔离数据
- 默认管理员账号（`admin`）与角色权限控制
- 管理员可在「用户管理」中查看用户、物品种类数、物品总件数、操作日志条数、最近登录时间，并可重置用户密码
- 注册支持预设验证问题或自定义问题，用于忘记密码时校验重置
- 平台关闭注册时仍保留注册入口，并展示暂未开放提示，避免误操作
- 登录页支持 Demo 一键体验（测试用户 `test` / `test123456`）

### 🎨 界面特性
- 深色 / 浅色主题一键切换，自动记忆偏好
- 毛玻璃 (Glassmorphism) 设计风格
- 全响应式布局，适配桌面和移动端
- 可折叠侧边栏（移动端自动收起）
- 移动端关键操作按钮自动纵向排布，避免拥挤
- 平滑动画和 Toast 通知反馈

---

## 技术架构

| 项目     | 说明                                        |
| -------- | ------------------------------------------- |
| 部署方式 | 单文件 `index.php`，零配置                  |
| 后端     | PHP + PDO                                   |
| 数据库   | SQLite（认证库 `data/auth_db.sqlite` + 用户库 `data/items_db*.sqlite`） |
| 前端     | Tailwind CSS + RemixIcon + Vanilla JS       |
| API 风格 | RESTful，通过 `?api=` 路由                  |
| 依赖     | 无需 Composer，CSS/JS 通过 CDN 加载         |
| 环境兼容 | Synology NAS Web Station / Apache / Nginx   |

---

## 文件结构

```
17ItemManager/
├── index.php          # 主程序（前后端一体）
├── test.php           # 环境检测脚本
├── README.md          # 项目说明文档
├── IMPLEMENTATION_DETAILS.md  # 功能与需求实现细节
└── data/              # 运行时自动创建
    ├── auth_db.sqlite     # 用户/认证数据库
    ├── items_db.sqlite    # 管理员默认物品库
    ├── items_db_u{ID}.sqlite # 普通用户独立物品库
    └── uploads/           # 图片上传目录
        └── trash/         # 回收站图片暂存目录
```

---

## 部署方法

1. 将 `index.php` 放入 Web 服务器目录
2. 确保 PHP 已启用 `pdo_sqlite` 扩展（可用 `test.php` 检测）
3. 确保目录可写（用于创建数据库和上传图片）
4. 浏览器直接访问 `index.php` 即可，首次访问自动初始化

---

## 更新记录

### v1.5.2 — 2026-02-19
**🔐 账号体验升级：注册双态提示 + 自定义验证问题 + Demo 覆盖增强**
- 注册页新增“开放注册 / 暂未开放”双态提示，登录与注册提示语分开显示
- 平台关闭注册时，创建账号按钮禁用并展示“暂未开放注册”说明
- 注册关闭状态下不再显示用户名、密码等注册输入框，减少无效填写
- 注册验证问题新增“自定义问题”，可自行填写问题与答案
- 找回密码可显示用户自定义验证问题，流程更连贯
- 用户管理卡片新增每位成员的操作日志条数，便于管理员快速了解活跃情况
- Demo 账号改为自定义验证问题样例，便于演示找回密码流程
- Demo 数据新增操作日志样例，覆盖日志查看与筛选场景
- 导出数据版本号同步升级为 `v1.5.2`

### v1.5.1 — 2026-02-18
**🧭 分类与位置体验升级：二级分类联动 + Emoji 图标分组 + 移动端优化**
- 新增默认一级分类“食物”，并补齐常用一级分类的预设二级分类
- 二级分类升级为独立物品属性，在“编辑物品”和“已购买入库”流程中都可填写
- 二级分类与一级分类联动，只显示当前一级分类下的可选项，减少误选
- 分类管理升级为一对多可视化视图，可直观看到一级分类与其二级分类关系
- 分类与位置图标输入升级为分组 Emoji 选择面板，选择更快更直观
- 位置图标统一改为 Emoji 展示，列表、筛选、编辑流程保持一致
- 公共频道“加入购物清单”流程优化，加入更稳定，备注文案更清晰（如“1件”）
- 公共频道权限体验优化：可清楚区分“仅发布者可编辑”与“其他用户可查看/评论”
- Demo 数据升级，覆盖二级分类、共享权限差异、评论互动与加入购物清单场景
- 修复 Demo 数据串入正式账号公共频道的问题，演示与正式数据边界更清晰
- 移动端日期输入框尺寸统一，分类管理与物品管理关键操作按钮改为纵向排布

### v1.5.0 — 2026-02-16
**🌐 公共频道升级：发布者编辑 + 推荐理由 + 评论协作**
- 新增公共频道编辑能力：仅发布者可编辑共享物品（名称、分类、购入价格、购入渠道、推荐理由）
- 新增“推荐理由”展示，帮助其他人更快判断是否值得购买
- 新增公共频道评论：所有用户可评论
- 新增评论删除：仅评论者本人或管理员可删除
- 共享物品下架后，相关评论会同步清理，公共频道更整洁
- 公共频道加入购物清单时会自动带上推荐理由，后续回看更直观
- Demo 数据新增公共频道共享样例、推荐理由与评论样例（含管理员评论）
- 侧边栏导航顺序优化，公共频道与设置相关入口布局更清晰

### v1.4.0 — 2026-02-12
**🔐 多用户登录体系 + 管理员用户管理 + Demo 一键体验**
- 新增账号体系：支持登录/注册/退出登录，每位用户只看到自己的物品数据
- 新增管理员角色与默认管理员账号（`admin`），兼容历史账号自动升级管理员
- 注册流程新增验证问题与答案，支持忘记密码按问题校验后重置
- 新增管理员「用户管理」页面：查看用户列表、角色、物品种类数/总件数、最近登录时间，并支持重置密码
- 登录页新增 Demo 按钮，点击即可一键进入展示环境（无需手动输入账号密码）
- Demo 登录体验优化：首次进入也能自动准备好演示账号和数据
- 展示模式覆盖状态、过期、循环提醒、购物清单、回收站等完整演示场景
- 展示模式数据来源统一，演示内容更稳定一致

### v1.3.0 — 2026-02-11
**🛒 购物清单增强 + 备忘提醒重构 + 交互与样式统一（持续补充）**
- 新增购物清单模块，支持预算、优先级、提醒日期与提醒备注
- 购物清单新增提醒日期与提醒备注，并接入仪表盘备忘提醒
- 仪表盘「循环提醒」改名为「备忘提醒」，合并展示物品提醒与清单提醒
- 新增从备忘提醒一键跳转购物清单并自动打开对应编辑弹窗
- 编辑清单弹窗新增左下角「已购买入库」按钮，可直接进入该条目的入库弹窗
- 入库流程与物品编辑体验保持一致，提交后会自动移除对应清单项
- 购物清单新增状态字段（待购买 / 待收货），页面按状态分组展示
- 编辑清单新增状态切换按钮（显示“已购买”或“待购买”），点击后自动保存并关闭弹窗
- 待收货分组为空时隐藏空状态文案，减少页面噪音
- 循环提醒支持待完成、已完成、撤销三种操作，处理更灵活
- 点击「待完成」后变为「已完成」，并自动生成下一次提醒记录
- 已完成状态支持「撤销」，可回滚当前状态并撤销对应下一条提醒记录
- 物品编辑支持下次提醒日期手动修改，并优化循环提醒行布局与字段顺序
- 日期输入空值统一占位为 `____年/__月/__日`，并修复空值/有值切换时尺寸跳动
- 优化位置管理描述展示、购物清单提醒备注单行截断、浅色模式中尺寸卡片操作区视觉
- 修复浅色模式下状态管理图标下拉菜单背景过深问题
- 优化浅色模式下“查看清单 / 待完成 / 已完成 / 撤销”等按钮文字与边框对比
- 优化仪表盘过期提醒与备忘提醒卡片在深浅色主题下的配色一致性
- 仪表盘备忘提醒新增分项统计：过期 / 循环 / 购物；分类统计与状态统计统一单位为“件”
- 展示模式补充清单与循环提醒示例，重置后演示环境更干净
- 补充更完整的实现说明文档，便于团队协作与后续维护

### v1.2.0 — 2026-02-09
**🧩 数据管理增强 + 批量导入完善 + 仪表盘优化**
- 设置菜单中的「导入/导出」统一改名为「数据管理」
- 新增「物品数据重置」与「恢复默认环境」
- 执行重置时，历史图片会先进入回收区，降低误删风险
- 数据管理新增「展示模式」，可一键导入演示数据用于功能展示
- 新增购入渠道管理（默认：淘宝/京东/拼多多/闲鱼/线下/礼品），添加/编辑物品改为下拉选择
- 移除位置上下级功能，位置管理统一为单级结构
- 分类管理固定显示「未分类」、位置管理固定显示「未设定」，并支持一键查看对应物品
- 物品管理过滤器新增「未分类 / 未设定」选项，便于筛出未绑定分类或位置的物品
- 物品管理新增「过期管理」过滤按钮（仅显示带过期日期的物品）
- 物品管理搜索栏支持属性关键词检索（分类/位置/购入渠道/备注/状态等），支持搜索按钮和 Enter 触发
- 物品排序新增名称 Z-A、价格低→高、数量少→多、最早更新/添加、过期日期近→远与远→近（空过期日期自动置后）
- 分类管理与位置管理新增排序按钮；下拉层级遮挡问题已修复，并默认跟随系统排序设置
- 导出文件名增加详细时间（精确到秒），并支持按需包含图片
- 导入时可同时恢复已导出的图片内容
- 新增手动批量导入（CSV 模板），模板内示例更清晰，便于快速上手
- 批量导入日期支持多种常见写法，错误行会自动跳过并提示
- 导入时分类/位置/购入渠道/状态支持模糊匹配已有值，不存在时自动回退默认值
- 仪表盘新增状态统计；分类统计可直接看到未分类件数，并聚焦在使用中的物品
- 仪表盘「过期提醒」「状态统计」在无数据时也保持显示空态，不再整块隐藏
- 浅色模式下优化过期提醒卡片与时间文本、分类进度条背景，降低突兀感
- 状态图标选择器支持可视化图标下拉（图标+名称）

### v1.1.0 — 2026-02-08
**🧱 核心功能完善与交互优化（整合 v1.1 ~ v2.0）**
- 新增「过期日期」字段，支持在物品表单中设置
- 仪表盘新增「过期提醒」板块与过期状态三级视觉标识
- 新增「排序设置」页面，可自定义仪表盘/物品/分类/位置排序并持久化
- 新增「复制物品」功能，支持从现有物品快速创建
- 新增「回收站」软删除流程（恢复/彻底删除/清空）与回收站详情
- 分类管理与位置管理新增「物品」按钮，支持一键跳转并筛选
- 侧边栏重构为「设置」父菜单，更新记录独立页面，左上角显示版本号
- 仪表盘布局与最近更新区优化，新增物品视图大小切换（大/中/小）
- 物品管理支持按状态分组显示，空组自动隐藏
- 新增状态管理（新增/删除）并支持状态编辑（名称/图标/颜色）
- 新增属性显示控制（分类、位置、件数、价格、过期日期、购入渠道、备注）
- 物品新增购入渠道与备注字段，表单布局优化
- 新增筛选重置按钮，并整体优化操作流畅度与视觉一致性
- 修复编辑回填与中尺寸图标显示等问题
- 历史数据会自动补齐新能力，升级后可直接继续使用

### v1.0.0 — 2026-02-08
**🎉 初始版本发布**
- 完整的物品增删改查功能
- 仪表盘统计面板（5 项核心指标 + 分类进度条）
- 分类管理（Emoji 图标 + 自定义颜色，预设 8 个常用分类）
- 位置管理（单级结构，预设 6 个常用位置）
- 图片上传与预览（支持 JPG / PNG / GIF / WebP）
- 全局搜索 + 多维度筛选 + 多种排序
- 物品详情弹窗
- 批量选择与批量删除
- 分页浏览
- 数据导出（JSON / CSV）与导入
- 深色 / 浅色主题切换
- 全响应式布局（桌面 + 移动端）
- 毛玻璃风格界面，配合动画与消息提示

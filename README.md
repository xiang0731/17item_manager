# 17 物品管理系统 (17 Item Manager) 

> 参考 Snipe-IT / Homebox / Grocy 设计的单文件 PHP 物品管理系统  
> 零配置部署，SQLite 数据库，适配 Synology NAS Web Station

详细实现文档：`IMPLEMENTATION_DETAILS.md`

---

## 功能概览

### 📊 仪表盘
- 五大统计卡片：物品种类、物品总数、分类数、位置数、总价值
- **过期提醒**：按过期日期排序展示，已过期 / 即将过期 / 正常三级颜色标识
- **备忘提醒**：统一展示循环提醒与购物清单提醒，支持待完成 / 已完成 / 撤销
- 新增“仪表盘管理”范围配置：可分别设置过期提醒/备忘提醒的“过期 X 天到未来 X 天”显示窗口
- 默认范围：过期提醒（过期不限制，未来 60 天）；备忘提醒（过期不限制，未来 3 天）
- 备忘提醒右上角分项统计：过期 / 循环 / 购物 三类提醒条数
- 最近更新物品列表（快速预览）
- 状态统计（自动隐藏 0 数据状态）
- 分类统计进度条（仅统计使用中物品），右上角显示未分类件数
- 分类统计与状态统计统一显示单位“件”
- 过期提醒与备忘提醒卡片在深浅色模式下统一优化色阶与边框对比
- 提醒卡片网格支持自适应铺满宽屏，减少右侧空白并保持时间文案可读性

### 📦 物品管理
- 卡片式网格展示，支持图片预览
- 完整字段：名称、一级分类、二级分类、位置、数量、价格、购入日期、条码/序列号、生产日期、保质期、过期日期、购入渠道、备注、标签、描述
- 自定义状态管理：预设使用中/已归档/已转卖，支持新增/编辑/删除状态（英文标识 + 中文显示）
- 按状态自动分组显示，空组隐藏
- 图片上传（支持 JPG / PNG / GIF / WebP，最大 10MB）
- 三种视图尺寸：大（卡片）/ 中（紧凑）/ 小（列表）
- **属性显示控制**：可自由勾选物品卡片中显示的属性（分类、位置、件数、价格、过期日期、购入渠道、备注）
- **过期管理过滤器**：一键筛选仅显示设置过过期日期的物品
- 多维度筛选：关键词搜索、分类、位置、状态
- 多种排序：最近更新 / 最近添加 / 名称 / 价格 / 数量
- 物品详情弹窗（点击卡片查看完整信息）
- 批量选择 + 批量删除（移入回收站）
- 分页浏览
- 日期空值占位统一为 `____年/__月/__日`
- 编辑弹窗关闭前支持未保存提醒（忽略修改 / 保存修改）

### 🛒 购物清单
- 独立购物清单页面，支持新增/编辑/删除
- 字段支持：名称、数量、状态、优先级、预算、提醒日期、提醒备注、备注
- 清单状态支持“待购买 / 待收货”，并按状态分组展示（待购买在上）
- 支持一键“已购买入库”，并复用物品编辑结构（提交文案为“保存入库”）
- 编辑清单新增状态切换按钮（“转为已购买 / 转为待购买”），点击后自动保存并关闭弹窗
- 待收货分组为空时不显示“暂无待收货清单”占位文案
- 可从仪表盘备忘提醒直接跳转购物清单并打开对应编辑弹窗

### 🌐 公共频道
- 物品可勾选“共享到公共频道”，向所有用户展示基础属性（分类、购入价格、购入渠道）
- 公共频道支持一键“加入我的购物清单”
- 加入购物清单时自动带入推荐理由等上下文信息，数量备注更清晰（如“1件”）
- 共享物品支持发布者编辑（仅发布者可编辑）
- 公共频道支持评论互动（所有用户可评论）
- 评论支持权限删除：仅评论者本人或管理员可删除
- 共享记录失效时自动清理关联评论，避免脏数据残留

### 🗑️ 回收站
- 删除的物品自动移入回收站（软删除），不会立即永久删除
- 回收站物品列表，显示物品信息和删除时间
- 单个恢复 / 全部恢复
- 单个彻底删除 / 清空回收站
- 物品关联图片同步移入 `data/uploads/trash/` 目录保存，恢复时自动移回
- 图片仅在清空回收站或彻底删除时才被永久移除
- 回收站入口位于物品管理视图内

### 🏷️ 分类管理
- 自定义分类名称、Emoji 图标、颜色
- 支持两级分类（一级 + 二级），二级分类可随一级分类联动选择
- 预设 10 个常用一级分类（含“虚拟产品”“食物”），并为每个一级分类预置常见二级分类
- 分类管理支持一对多可视化展示（一级分类 -> 二级分类）
- 显示每个分类下的物品数量

### 📍 位置管理
- 单级位置管理（所有位置同一层级）
- 默认预置常用位置（客厅、卧室、厨房、书房），支持后续自由扩展
- 位置支持 Emoji 图标，列表展示、筛选和编辑体验一致
- 位置描述和物品统计

### 🔄 数据管理
- 导出 JSON 文件（完整备份，含物品、分类、位置；文件名精确到秒）
- 可选同时导出图片数据（嵌入式 Base64）
- 导出 CSV 文件（方便 Excel 查看和编辑）
- 从 JSON 文件导入恢复（支持带内置图片数据）
- 手动批量导入：下载默认 Excel 模板（CSV）后批量导入
- 批量导入/导出支持生产日期与保质期字段；当生产日期 + 保质期完整时自动推算过期日期
- 批量导入日期校验：支持 `YYYY-MM-DD` / `YYYY/MM/DD`（如 `2026/2/9`），不合规行自动跳过并给出可手动关闭提示
- 导入模糊匹配：分类/位置/购入渠道/状态支持模糊匹配已有值，不存在时使用默认值
- 数据管理内置「物品数据重置」与「恢复默认环境」

### ⚙️ 通用设置
- 统一设置入口：仪表盘管理、排序设置
- 仪表盘管理支持按业务需要限制提醒可见时间范围（留空表示不限制）
- 排序设置支持仪表盘分类统计、物品列表、分类列表、位置列表的默认顺序

### 👤 账号与权限
- 登录/注册/退出登录完整流程，按用户隔离数据
- 默认管理员账号（`admin`）与角色权限控制
- 管理员可在「用户管理」中查看用户、物品种类数、物品总件数、操作日志条数、最近登录时间，并可重置用户密码
- 注册支持预设验证问题或自定义问题，用于忘记密码时校验重置
- 平台关闭注册时仍保留注册入口，并展示暂未开放提示，避免误操作
- 登录页支持 Demo 一键体验（测试用户 `test` / `test123456`）

### 🎨 界面特性
- 深色 / 浅色主题一键切换，自动记忆偏好
- 毛玻璃 (Glassmorphism) 设计风格
- 全响应式布局，适配桌面和移动端
- 可折叠侧边栏（移动端自动收起）
- 帮助模式默认开启：字段名后显示 `?`，悬停可查看用途说明（可在顶部菜单中随时关闭）
- 移动端关键操作按钮自动纵向排布，避免拥挤
- 平滑动画和 Toast 通知反馈

---

## 技术架构

| 项目     | 说明                                        |
| -------- | ------------------------------------------- |
| 部署方式 | 单文件 `index.php`，零配置                  |
| 后端     | PHP + PDO                                   |
| 数据库   | SQLite（认证库 `data/auth_db.sqlite` + 用户库 `data/items_db*.sqlite`） |
| 前端     | Tailwind CSS + RemixIcon + Vanilla JS       |
| API 风格 | RESTful，通过 `?api=` 路由                  |
| 依赖     | 无需 Composer，CSS/JS 通过 CDN 加载         |
| 环境兼容 | Synology NAS Web Station / Apache / Nginx   |

---

## 文件结构

```
17ItemManager/
├── index.php          # 主程序（前后端一体）
├── test.php           # 环境检测脚本
├── README.md          # 项目说明文档
├── IMPLEMENTATION_DETAILS.md  # 功能与需求实现细节
└── data/              # 运行时自动创建
    ├── auth_db.sqlite     # 用户/认证数据库
    ├── items_db.sqlite    # 管理员默认物品库
    ├── items_db_u{ID}.sqlite # 普通用户独立物品库
    └── uploads/           # 图片上传目录
        └── trash/         # 回收站图片暂存目录
```

---

## 部署方法

1. 将 `index.php` 放入 Web 服务器目录
2. 确保 PHP 已启用 `pdo_sqlite` 扩展（可用 `test.php` 检测）
3. 确保目录可写（用于创建数据库和上传图片）
4. 浏览器直接访问 `index.php` 即可，首次访问自动初始化

---

## 更新记录

### v1.6.4 — 2026-02-21
#### 新功能
- 编辑清单状态切换按钮文案改为“转为已购买 / 转为待购买”，操作意图更清晰

#### 逻辑变更与优化
- 状态切换成功提示改为“已转为待收货 / 已转为待购买”，与按钮语义一致
- 帮助文本与"帮助文档"补充"购物清单"状态切换说明，明确编辑态快捷切换方式
- Demo "购物清单"样例更新状态切换提示文案，便于演示“待购买 ↔ 待收货”流程
- 同步更新技术栈报告与实现细节文档中的对应说明

#### bug修复
- 暂无

### v1.6.3 — 2026-02-21
- 物品编辑与“已购买入库”新增“生产日期 + 保质期（数字 + 天/周/月/年）”输入
- 生产日期与保质期完整时，系统会自动更新过期日期；后端保存时也会执行同规则兜底
- 字段顺序优化：条码/序列号与过期日期位置调整，过期信息集中在日期区块展示
- CSV/JSON 导入导出与批量模板同步补充生产日期、保质期字段，兼容旧数据
- Demo 数据补充保质期示例（临期、已过期、正常库存）便于验证提醒逻辑
- "帮助文档"与字段提示同步更新新增字段和留空规则说明

### v1.6.2 — 2026-02-20
- 帮助模式改为默认开启，首次进入即可通过字段后的问号快速理解每个输入项
- 顶部菜单整合当前登录用户名、帮助模式开关与退出登录入口，操作路径更统一
- 帮助提示定位和换行策略优化，编辑物品等密集表单中的提示不再轻易溢出
- 帮助文案升级为“零基础友好”的混合版表达，提醒字段解释更直白
- "设置"二级菜单中的"帮助文档"保持在"更新记录"上方，便于先看说明再看版本变更
- Demo 数据更新：循环提醒频率、会员续费、"购物清单"与任务样例更贴近日常场景

### v1.6.1 — 2026-02-19
- "通用设置"结构重整：按“仪表盘相关 / 列表页面相关”分组展示，查找更直观
- 提醒能力整合：余量提醒阈值并入"通用设置"，避免多入口来回切换
- 设置项顺序优化："仪表盘"组内按“提醒显示范围 → 分类统计排序 → 余量提醒阈值”排列
- 用户操作日志优化：仅显示业务描述，不再展示“当前返回多少条”
- 设置变更日志优化：只记录实际改动项，避免未改动项重复出现
- 下拉筛选与编辑表单交互更顺滑，长时间停留页面时资源占用更稳定
- 分类与位置等基础数据加载策略优化，频繁切换页面时等待更少
- 物品详情打开流程优化，减少无效加载带来的等待

### v1.6.0 — 2026-02-19
- "设置页"新增“仪表盘管理”，可分别配置过期提醒与备忘提醒显示范围
- 过期提醒支持“过期 X 天到未来 X 天”范围，留空可不限制
- 备忘提醒支持“过期 X 天到未来 X 天”范围，留空可不限制
- 默认范围更新为：过期提醒（过期不限制，未来 60 天）；备忘提醒（过期不限制，未来 3 天）
- "仪表盘"提醒卡片网格升级为自适应铺满：仅在可容纳新卡片时自动增列，减少大面积留白
- 提醒时间文案优化为单行显示，降低换行导致的信息断裂

### v1.5.2 — 2026-02-19
- "注册页"新增“开放注册 / 暂未开放”双态提示，"登录页"与"注册页"提示语分开显示
- 平台关闭注册时，创建账号按钮禁用并展示“暂未开放注册”说明
- 注册关闭状态下不再显示用户名、密码等注册输入框，减少无效填写
- 注册验证问题新增“自定义问题”，可自行填写问题与答案
- 找回密码可显示用户自定义验证问题，流程更连贯
- "用户管理"卡片新增每位成员的操作日志条数，便于管理员快速了解活跃情况

### v1.5.1 — 2026-02-18
- 新增默认一级分类“食物”，并补齐常用一级分类的预设二级分类
- 二级分类升级为独立物品属性，在“编辑物品”和“已购买入库”流程中都可填写
- 二级分类与一级分类联动，只显示当前一级分类下的可选项，减少误选
- "分类管理"升级为一对多可视化视图，可直观看到一级分类与其二级分类关系
- 分类与位置图标输入升级为分组 Emoji 选择面板，选择更快更直观
- 位置图标统一改为 Emoji 展示，列表、筛选、编辑流程保持一致
- "公共频道"加入"购物清单"流程优化，加入更稳定，备注文案更清晰（如“1件”）
- "公共频道"权限体验优化：可清楚区分“仅发布者可编辑”与“其他用户可查看/评论”
- "公共频道"数据隔离优化，避免不同账号之间出现错误穿透
- 移动端日期输入框尺寸统一，"分类管理"与"物品管理"关键操作按钮改为纵向排布

### v1.5.0 — 2026-02-16
- 新增"公共频道"编辑能力：仅发布者可编辑共享物品（名称、分类、购入价格、购入渠道、推荐理由）
- 新增“推荐理由”展示，帮助其他人更快判断是否值得购买
- 新增"公共频道"评论：所有用户可评论
- 新增评论删除：仅评论者本人或管理员可删除
- 共享物品下架后，相关评论会同步清理，"公共频道"更整洁
- "公共频道"加入"购物清单"时会自动带上推荐理由，后续回看更直观
- 侧边栏导航顺序优化，"公共频道"与"设置"相关入口布局更清晰

### v1.4.0 — 2026-02-12
- 新增账号体系：支持登录/注册/退出登录，每位用户只看到自己的物品数据
- 新增管理员角色与默认管理员账号（`admin`），兼容历史账号自动升级管理员
- 注册流程新增验证问题与答案，支持忘记密码按问题校验后重置
- 新增管理员"用户管理"页面：查看用户列表、角色、物品种类数/总件数、最近登录时间，并支持重置密码

### v1.3.0 — 2026-02-11
- 新增"购物清单"模块，支持预算、优先级、提醒日期与提醒备注
- "购物清单"新增提醒日期与提醒备注，并接入"仪表盘"备忘提醒
- "仪表盘"「循环提醒」改名为「备忘提醒」，合并展示物品提醒与清单提醒
- 新增从备忘提醒一键跳转"购物清单"并自动打开对应编辑弹窗
- 编辑清单弹窗新增左下角「已购买入库」按钮，可直接进入该条目的入库弹窗
- 入库流程与物品编辑体验保持一致，提交后会自动移除对应清单项
- "购物清单"新增状态字段（待购买 / 待收货），页面按状态分组展示
- 编辑清单新增状态切换按钮（显示“转为已购买”或“转为待购买”），点击后自动保存并关闭弹窗
- 待收货分组为空时隐藏空状态文案，减少页面噪音
- 循环提醒支持待完成、已完成、撤销三种操作，处理更灵活
- 点击「待完成」后变为「已完成」，并自动生成下一次提醒记录
- 已完成状态支持「撤销」，可回滚当前状态并撤销对应下一条提醒记录
- 物品编辑支持下次提醒日期手动修改，并优化循环提醒行布局与字段顺序
- 日期输入空值统一占位为 `____年/__月/__日`，并修复空值/有值切换时尺寸跳动
- 优化"位置管理"描述展示、"购物清单"提醒备注单行截断、浅色模式中尺寸卡片操作区视觉
- 修复浅色模式下"状态管理"图标下拉菜单背景过深问题
- 优化浅色模式下“查看清单 / 待完成 / 已完成 / 撤销”等按钮文字与边框对比
- 优化"仪表盘"过期提醒与备忘提醒卡片在深浅色主题下的配色一致性
- "仪表盘"备忘提醒新增分项统计：过期 / 循环 / 购物；分类统计与状态统计统一单位为“件”

### v1.2.0 — 2026-02-09
- "设置"菜单中的「导入/导出」统一改名为"数据管理"
- 新增「物品数据重置」与「恢复默认环境」
- 执行重置时，历史图片会先进入回收区，降低误删风险
- 新增"购入渠道管理"（默认：淘宝/京东/拼多多/闲鱼/线下/礼品），添加/编辑物品改为下拉选择
- 移除位置上下级功能，"位置管理"统一为单级结构
- "分类管理"固定显示「未分类」、"位置管理"固定显示「未设定」，并支持一键查看对应物品
- "物品管理"过滤器新增「未分类 / 未设定」选项，便于筛出未绑定分类或位置的物品
- "物品管理"新增「过期管理」过滤按钮（仅显示带过期日期的物品）
- "物品管理"搜索栏支持属性关键词检索（分类/位置/购入渠道/备注/状态等），支持搜索按钮和 Enter 触发
- 物品排序新增名称 Z-A、价格低→高、数量少→多、最早更新/添加、过期日期近→远与远→近（空过期日期自动置后）
- "分类管理"与"位置管理"新增排序按钮；下拉层级遮挡问题已修复，并默认跟随系统排序设置
- 导出文件名增加详细时间（精确到秒），并支持按需包含图片
- 导入时可同时恢复已导出的图片内容
- 新增手动批量导入（CSV 模板），模板内示例更清晰，便于快速上手
- 批量导入日期支持多种常见写法，错误行会自动跳过并提示
- 导入时分类/位置/购入渠道/状态支持模糊匹配已有值，不存在时自动回退默认值
- "仪表盘"新增状态统计；分类统计可直接看到未分类件数，并聚焦在使用中的物品
- "仪表盘"「过期提醒」「状态统计」在无数据时也保持显示空态，不再整块隐藏
- 浅色模式下优化过期提醒卡片与时间文本、分类进度条背景，降低突兀感
- 状态图标选择器支持可视化图标下拉（图标+名称）

### v1.1.0 — 2026-02-08
- 新增「过期日期」字段，支持在物品表单中设置
- "仪表盘"新增「过期提醒」板块与过期状态三级视觉标识
- 新增「排序设置」页面，可自定义"仪表盘"/"物品管理"/"分类管理"/"位置管理"排序并持久化
- 新增「复制物品」功能，支持从现有物品快速创建
- 新增"回收站"软删除流程（恢复/彻底删除/清空）与"回收站"详情
- "分类管理"与"位置管理"新增「物品」按钮，支持一键跳转并筛选
- 侧边栏重构为"设置"父菜单，"更新记录"独立页面，左上角显示版本号
- "仪表盘"布局与最近更新区优化，新增物品视图大小切换（大/中/小）
- "物品管理"支持按状态分组显示，空组自动隐藏
- 新增"状态管理"（新增/删除）并支持状态编辑（名称/图标/颜色）
- 新增属性显示控制（分类、位置、件数、价格、过期日期、购入渠道、备注）
- 物品新增购入渠道与备注字段，表单布局优化
- 新增筛选重置按钮，并整体优化操作流畅度与视觉一致性
- 修复编辑回填与中尺寸图标显示等问题
- 历史数据会自动补齐新能力，升级后可直接继续使用

### v1.0.0 — 2026-02-08
- 完整的物品增删改查功能
- "仪表盘"统计面板（5 项核心指标 + 分类进度条）
- "分类管理"（Emoji 图标 + 自定义颜色，预设 8 个常用分类）
- "位置管理"（单级结构，预设 6 个常用位置）
- 图片上传与预览（支持 JPG / PNG / GIF / WebP）
- 全局搜索 + 多维度筛选 + 多种排序
- 物品详情弹窗
- 批量选择与批量删除
- 分页浏览
- 数据导出（JSON / CSV）与导入
- 深色 / 浅色主题切换
- 全响应式布局（桌面 + 移动端）
- 毛玻璃风格界面，配合动画与消息提示
